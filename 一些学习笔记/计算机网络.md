ARP协议
ARP（Address Resolution Protocol）即地址解析协议， 用于实现从 IP 地址到 MAC 地址的映射，即询问目标IP对应的MAC地址。

DHCP协议
DHCP(Dynamic Host Configuration Protocol),动态主机配置协议，是一个应用层协议。当我们将客户主机ip地址设置为动态获取方式时，DHCP服务器就会根据DHCP协议给客户端分配IP，使得客户机能够利用这个IP上网。

主机新加入网络时，获取IP的流程 ：
1. 新的client加入网络时，会使用0.0.0.0作为源地址，发送discover广播报文，查询网络上有哪些DHCP server，以及这些DHCP server 能Offer哪些IP地址 
2. DHCP服务器接收到DHCP Discover报文后，回应Offer报文，提供IP地址（可能包含DNS等其他信息）给client 
3. client 根据收到的Offer报文，选择一个DHCP server，并选择它提供的IP地址。然后广播Request报文，想DHCP Server请求该IP地址，同时想本地网络（尤其是其他DHCP Server）公告自己已经选择了某个DHCP Server的某个IP地址。 
4. DHCP Server 回应ACK报文，将IP地址分配给Client端 （特殊情况：DHCP Server在发送Offer报文和接收到Request的短暂时间内把IP分配给了其他主机） 
5. DHCP Client 收到ACK报文后，会针对获得的IP地址发送ARP Request，进行IP地址冲突检测。 
6. 如果IP地址已经被其他主机使用，则Client放弃该IP地址，想Server发送DHCP DECLINE报文告诉Server该地址不能使用。然后一段时间后（一般10s）再此尝试获取该IP地址 
7. 如果Client仍然无法使用该IP地址，则发送DHCP RELEASE报文，放弃该地址。

DHCP服务的工作过程是这样的：
1. 发现Discover阶段，即DHCP客户机寻找DHCP服务器的阶段。DHCP客户机以广播方式（因为DHCP服务器的IP地址对于客户机来说是未知的）发送DHCP discover发现信息来寻找DHCP服务器，即向地址255.255.255.255发送特定的广播信息。网络上每一台安装了TCP/IP协议的主机都会接收到这种广播信息，但只有DHCP服务器才会做出响应。
2. 提供Offer阶段，即DHCP服务器提供IP地址的阶段。在网络中接收到DHCP discover发现信息的DHCP服务器都会做出响应，它从尚未出租的IP地址中挑选一个分配给DHCP客户机，向DHCP客户机发送一个包含出租的IP地址和其他设置的DHCP offer提供信息。
3. 选择Request阶段，即DHCP客户机选择某台DHCP服务器提供的IP地址的阶段。如果有多台DHCP服务器向DHCP客户机发来的DHCP offer提供信息，则DHCP客户机只接受第一个收到的DHCP offer提供信息，然后它就以广播方式回答一个DHCP request请求信息，该信息中包含向它所选定的DHCP服务器请求IP地址的内容。之所以要以广播方式回答，是为了通知所有的DHCP服务器，他将选择某台DHCP服务器所提供的IP地址。
4. 确认Ack阶段，即DHCP服务器确认所提供的IP地址的阶段。当DHCP服务器收到DHCP客户机回答的DHCP request请求信息之后，它便向DHCP客户机发送一个包含它所提供的IP地址和其他设置的DHCP ack确认信息，告诉DHCP客户机可以使用它所提供的IP地址。然后DHCP客户机便将其TCP/IP协议与网卡绑定，另外，除DHCP客户机选中的服务器外，其他的DHCP服务器都将收回曾提供的IP地址。
5. 重新登录。以后DHCP客户机每次重新登录网络时，就不需要再发送DHCP discover发现信息了，而是直接发送包含前一次所分配的IP地址的DHCP request请求信息。当DHCP服务器收到这一信息后，它会尝试让DHCP客户机继续使用原来的IP地址，并回答一个DHCP ack确认信息。如果此IP地址已无法再分配给原来的DHCP客户机使用时（比如此IP地址已分配给其它DHCP客户机使用），则DHCP服务器给DHCP客户机回答一个DHCP nack否认信息。当原来的DHCP客户机收到此DHCP nack否认信息后，它就必须重新发送DHCP discover发现信息来请求新的IP地址。
6. 更新租约。DHCP服务器向DHCP客户机出租的IP地址一般都有一个租借期限，期满后DHCP服务器便会收回出租的IP地址。如果DHCP客户机要延长其IP租约，则必须更新其IP租约。DHCP客户机启动时和IP租约期限过一半时，DHCP客户机都会自动向DHCP服务器发送更新其IP租约的信息。

DHCP的优缺点
DHCP服务优点不少：网络管理员可以验证IP地址和其它配置参数，而不用去检查每个主机；DHCP不会同时租借相同的IP地址给两台主机；DHCP管理员可以约束特定的计算机使用特定的IP地址；可以为每个DHCP作用域设置很多选项；客户机在不同子网间移动时不需要重新设置IP地址。
但同时也存在不少缺点：DHCP不能发现网络上非DHCP客户机已经在使用的IP地址；当网络上存在多个DHCP服务器时，一个DHCP服务器不能查出已被其它服务器租出去的IP地址；DHCP服务器不能跨路由器与客户机通信，除非路由器允许BOOTP转发。


TCP/IP协议(Transfer Controln Protocol/Internet Protocol)叫做传输控制/网际协议
 
     (a)网际协议IP：负责在主机和网络之间的路径寻址和数据包路由。
　　(b)地址解析协议ARP：获得同一物理网络中的主机硬件地址。
　　(c)网际控制消息协议ICMP：发送消息，并报告有关数据包的传送错误。
(d)互联组管理协议IGMP：用来实现本地多路广播路由器报告。

分层：
（1）链路层 ：设备驱动程序、网络接口卡，对应物理细节。 
（2）网络层 ：IP协议、ICMP协议、IGMP协议。提供的是一种不可靠的服务，它只是尽可能快的把分组从源节点送到目的节点，但是不提供任何可靠性保证。 
（3）运输层 ：提供端到端的通信。两个传输协议：TCP、UDP。特点：可靠，弥补网络层上不可靠特点。TCP采用超时重传、发送和接收端到端的确认分组机制。 
（4）应用层 ：负责处理特定的应用程序细节。 应用层关心的是应用程序的细节，而不是数据在网络中的传输活动。下三层对应用程序一无所知，但它们要处理所有的通信细节。
一个互联网就是通过一组相同协议族互连在一起的网络。 
路由器：为不同类型的物理网络提供连接：以太网、令牌环网、点对点的链接、FDDI（光纤分布式数据接口）。 
网桥：在链路层上对网络进行互连。路由器是在网络层上对网络进行互连。
 
 

TCP/IP通信数据流
 
（1）互联网地址分为五大类： 
A类 0 7位网络号+24位主机号 0.0.0.0到127.255.255.255 
B类 10 14位网络号+16位主机号 128.0.0.0到191.255.255.255 
C类 110 21位网络号+8位主机号 192.0.0.0到223.255.255.255 
D类 1110 28位多播组号 224.0.0.0到239.255.255.255 
E类 11110 27位留待后用 240.0.0.0到255.255.255.255 
（2）封装 
当应用程序用TCP传送数据时，数据被送入协议栈中，然后逐个通过每一层直到被当做一串比特流送入网络。其中每一层对收到的数据都要增加一些首部信息。 
TCP传给IP的数据单元称为TCP报文段；IP传送给网络接口层的数据单元称为IP数据报。通过以太网传输的比特流称作帧。UDP传给IP的信息单元称为UDP数据报。 
IP在首部存入一个长度为8bit的数值，称为协议域。1表示ICMP协议，2表示IGMP协议，6表示TCP协议，17表示UDP协议。 
(3)分用 
当目的主机收到一个以太数据帧时，数据就开始从协议栈中由底向上升，同时去掉各层协议加上的报文首部。每层协议盒都要去检查报文首部中的协议标识，以确定接收数据的上层协议。

IP协议：这里的IP不是值得我们通常所说的192.168.1.1.这个IP指的是一种协议，而后面的数字值得是IP地址。IP协议负责在主机和网络之间的路径寻址和数据包路由，其中两个重要的条件是IP地址，和MAC地址（Media Access Control Address）。由于IP地址是稀有资源，不可能每个人都拥有一个IP地址，所以我们通常的IP地址是路由器给我们生成的IP地址，路由器里面会记录我们的MAC地址。
TCP协议：如果说IP协议是找到对方的详细地址。那么TCP协议就是把安全的把东西带给对方。
TCP属于传输层，提供可靠的字节流服务。
所谓的字节流服务（Byte Stream Service）是指，为了方便传输，将大块数据分割成以报文段（segment）为单位的数据包进行管理。而可靠的传输服务是指，能够把数据准确可靠地传给对方。一言以蔽之，TCP 协议为了更容易传送大数据才把数据分割，而且 TCP 协议能够确认数据最终是否送达到对方。
为了确保信息能够准确无误的到达，TCP采用了著名的三次握手策略（three-way handshaking）.下面我写一段对话来模拟下这三次握手。
 
 
OSI（Open System Interconnect），即开放式系统互联。 一般都叫OSI参考模型。
OSI定义了网络互连的七层框架（物理层、数据链路层、网络层、传输层、会话层、表示层、应用层），即ISO开放互连系统参考模型。
 
TCP/IP五层协议和OSI的七层协议对应关系如下：
 

一个设备工作在哪一层，关键看它工作时利用哪一层的数据头部信息。网桥工作时，是以MAC头部来决定转发端口的，因此显然它是数据链路层的设备。
具体如下:
物理层：网卡，网线，集线器，中继器，调制解调器。
数据链路层：网桥，交换机
网络层：路由器
网关工作在第四层传输层及其以上
集线器是物理层设备,采用广播的形式来传输信息。

交换机是一种基于MAC地址识别，能完成封装转发数据包功能的网络设备。
交换机就是用来进行报文交换的机器。多为链路层设备(二层交换机)，能够进行地址学习，采用存储转发的形式来交换报文。

路由器主要克服了交换机不能路由转发数据包的不足。
路由器的一个作用是连通不同的网络，另一个作用是选择信息传送的线路。


 
总的来说，路由器与交换机的主要区别体现在以下几个方面： 
（1）工作层次不同 
最初的的交换机是工作在数据链路层，而路由器一开始就设计工作在网络层。由于交换机工作在数据链路层，所以它的工作原理比较简单，而路由器工作在网络层，可以得到更多的协议信息，路由器可以做出更加智能的转发决策。 
（2）数据转发所依据的对象不同 
交换机是利用物理地址或者说MAC地址来确定转发数据的目的地址。而路由器则是利用IP地址来确定数据转发的地址。IP地址是在软件中实现的，描述的是设备所在的网络。MAC地址通常是硬件自带的，由网卡生产商来分配的，而且已经固化到了网卡中去，一般来说是不可更改的。而IP地址则通常由网络管理员或系统自动分配。 
（3）传统的交换机只能分割冲突域，不能分割广播域；而路由器可以分割广播域 
由交换机连接的网段仍属于同一个广播域，广播数据包会在交换机连接的所有网段上传播，在某些情况下会导致通信拥挤和安全漏洞。连接到路由器上的网段会被分配成不同的广播域，广播数据不会穿过路由器。虽然第三层以上交换机具有VLAN功能，也可以分割广播域，但是各子广播域之间是不能通信交流的，它们之间的交流仍然需要路由器。 
（4）路由器提供了防火墙的服务 
路由器仅仅转发特定地址的数据包，不传送不支持路由协议的数据包传送和未知目标网络数据包的传送，从而可以防止广播风暴。


物理层
物理层的主要功能是：利用传输介质为数据链路层提供物理连接，实现比特流的透明传输。
物理层的作用是实现相邻计算机节点之间比特流的透明传送，尽可能屏蔽掉具体传输介质和物理设备的差异。使其上面的数据链路层不必考虑网络的具体传输介质是什么。

数据链路层
数据链路层的主要功能是在物理层提供的比特流的基础上，通过差错控制、流量控制方法，使有差错的物理线路变为无差错的数据链路，即提供可靠的通过物理介质传输数据的方法。
数据链路层的具体工作是接收来自物理层的位流形式的数据，并封装成帧，传送到上一层；同样，也将来自上层的数据帧，拆装为位流形式的数据转发到物理层；并且，还负责处理接收端发回的确认帧的信息，以便提供可靠的数据传输。

网络层
网络层主要任务是：通过路由选择算法，为报文或分组通过通信子网选择最适当的路径。具体地说，数据链路层的数据在这一层被转换为数据包，然后通过路径选择、分段组合、顺序、进/出路由等控制，将信息从一个网络设备传送到另一个网络设备。
一般地，数据链路层是解决同一网络内节点之间的通信，而网络层主要解决不同子网间的通信。例如在广域网之间通信时，必然会遇到路由（即两节点间可能有多条路径）选择问题。
 路由算法：当源节点和目的节点之间存在多条路径时，本层可以根据路由算法，通过网络为数据分组选择最佳路径，并将信息从最合适的路径由发送端传送到接收端。
 连接服务：与数据链路层流量控制不同的是，前者控制的是网络相邻节点间的流量，后者控制的是从源节点到目的节点间的流量。其目的在于防止阻塞，并进行差错检测。
 

传输层
传输层主要任务是：向用户提供可靠的端到端的差错和流量控制，保证报文的正确传输。
传输层的主要功能如下：
传输连接管理：提供建立、维护和拆除传输连接的功能。传输层在网络层的基础上为高层提供“面向连接”和“面向无接连”的两种服务。
处理传输差错：提供可靠的“面向连接”和不太可靠的“面向无连接”的数据传输服务、差错控制和流量控制。
监控服务质量。

会话层
会话层主要任务是：向两个实体的表示层提供建立和使用连接的方法。将不同实体之间的表示层的连接称为会话。因此会话层的任务就是组织和协调两个会话进程之间的通信，并对数据交换进行管理。
用户可以按照半双工、单工和全双工的方式建立会话。

表示层
表示层主要功能是“处理用户信息的表示问题，如编码、数据格式转换和加密解密”等。表示层的具体功能如下：
数据格式处理、数据的编码、压缩和解压缩、数据的加密和解密。

应用层
应用层功能是直接向用户提供服务，完成用户希望在网络上完成的各种工作。
应用层的主要功能如下：
用户接口：应用层是用户与网络，以及应用程序与网络间的直接接口，使得用户能够与网络进行交互式联系。
实现各种服务：该层具有的各种应用程序可以完成和实现用户请求的各种服务。

从网络功能的角度观察：下面4层（物理层、数据链路层、网络层和传输层）主要提供数据传输和交换功能，即以节点到节点之间的通信为主；第4层作为上下两部分的桥梁，是整个网络体系结构中最关键的部分；而上3层（会话层、表示层和应用层）则以提供用户与应用程序之间的信息和数据处理功能为主。简言之，下4层主要完成通信子网的功能，上3层主要完成资源子网的功能。

